<script type="text/javascript" charset="utf-8">
    var pie_url = "<%= url_for :controller=>'report', :action=>'category_last_month' %>";
    var history_url = "<%= url_for :controller=>'report', :action=>'history', :last_period=>1 %>";

    $(document).ready(function(){
        $.getJSON(pie_url, function(data){
            var options = {
                pie: { 
                    show: true, 
                    pieStrokeLineWidth: 1, 
                    pieStrokeColor: '#FFF', 
                    showLabel: false
                },
                legend: {
                    show: true,
                    container:$("#month-category-pie-legend")
                }
            }
            $.plot($('#month-category-pie'), data, options)
        })

        $.getJSON(history_url, {}, function(data){
            var container = $("#credit-last-month");
            for(s in data){
                for(i in data[s]['data']){
                    data[s]['data'][i][0] = $.datepicker.parseDate('yy-mm-dd', data[s]['data'][i][0]);
                }
            }
            var options = { 
               lines: { show: true },
               xaxis:{
                   mode:'time',
               },
               legend: {
                   show: true,
                   container:$("#credit-last-month-legend")
               }
             }
            $.plot(container, data, options)
            container.toggleClass("loading-plot")
        })
        
    })
</script>

<div class="span-6 colborder">
    <h5>spese questo mese</h5>
    <div id="month-category-pie" class="span-4 loading-plot" style="height:150px;width:150px"></div>
    <div class="span-2 last" id="month-category-pie-legend"></div>
</div>
<div class="span-6 colborder">
    <h5>spese stato crediti e debiti</h5>
    <div id="credit-last-month" class="span-4 loading-plot" style="height:150px;width:150px"></div>
    <div class="span-2 last" id="credit-last-month-legend"></div>
</div>
<div class="span-5 last">
    <h5>spese di oggi</h5>
    <% form_remote_for :expense, @expense, :url=>{:action=>'create_home'}, :html=>{:id=>'new-expense-home'}, :complete =>"" do |f| %>
          <div class="flash error hide" id="new-expense-home-errors"></div>
          <div class="span-3">
              <%= f.text_field :description, :class=>"span-3"%>
              <div class="tooltip top small white"><%= t "Description" %></div>
          </div>
          <div class="span-2 last">
              <%= f.text_field :amount, :size=>9 %>
              <div class="tooltip top small white"><%= t "Amount" %></div>
          </div>
          <div class="span-5">
              <%= f.select :expensegroup_ids, Expensegroup.all.collect{|u| [u.name, u.id]}, {},  {:multiple=> true, :class=> 'hide'} %>
              <%= f.select :user_ids, User.all.collect{|u| [u.login, u.id]}, {},  {:multiple=> true, :class=> 'hide'} %>
              <select id="dummy_user_group" disabled="disabled"></select>
          </div>
          <div class="tooltip top white small"><%= t "Users" %></div>
          <div class="span-5">
              <%= f.select :category_id , get_user_categories_for_expense(@expense).collect {|p| [ p.name, p.id ] } %>
              <div class="tooltip top small white"><%= t "Category" %></div>
          </div>
          <div class="span-2 last"><%= submit_tag "add"%></div>
    <% end %>
</div>