<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
       "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  <title>
    Convivium - <%= controller.controller_name %>:<%= controller.action_name %>
  </title>     
  <% stylesheet_link_tag 'print' %>     
  <%= stylesheet_link_tag 'screen' %>   
  <%= stylesheet_link_tag 'style' %>   
  <!--[if IE]>           
  <%= stylesheet_link_tag 'ie' %>     
  <![endif]-->       
  <%= stylesheet_link_tag 'scaffold' %>
  <%= stylesheet_link_tag 'global' %>
  <%= stylesheet_link_tag 'flick/jquery-ui.css' %>
  <%= stylesheet_link_tag 'jquery.gritter.css' %>

  <%= stylesheet_link_tag 'scaffold' %>
  <%= stylesheet_link_tag 'global' %>

  <%= javascript_include_tag :defaults %>  
  <%= javascript_include_tag 'jquery.gritter.js' %>
  <%= javascript_include_tag 'jquery.fcbkcomplete.js' %>
  
  
  <script type="text/javascript" charset="utf-8">
    $(document).ready(function(){    
      
      function push_group_users(item) {
        var item = eval("item=" + item);    
        $.ajax({
          url: "<%= url_for :controller => 'expenses', :action => 'group_users' %>",
          data: "group_id=" + item._value,
          dataType: "html",
          success: function(data) {            
            $("#expense_user_ids").trigger("addItem", [eval(data)]);
          }
        });
      }                   
      
      $("#expense_user_ids, #expensegroup_user_ids").val("").html("");        
      $("#expense_user_ids").fcbkcomplete({
        json_url: "<%= url_for :controller => 'expenses', :action => 'users_autocomplete' %>",
        cache: true,
        filter_case: true,
        filter_hide: true,
        newel: false
      });   
      
      $("#expensegroup_user_ids").fcbkcomplete({
        json_url: "<%= url_for :controller => 'expenses', :action => 'users_autocomplete' %>",
        cache: true,
        filter_case: true,
        filter_hide: true,
        newel: false
      });   
      
      $("#expense_expensegroup_ids").fcbkcomplete({
        json_url: "<%= url_for :controller => 'expenses', :action => 'groups_autocomplete' %>",
        cache: true,                                    
        onselect: push_group_users,
        filter_case: true,
        filter_hide: true,
        newel: false
      });
                 
      <% if @users_expense %>
      $("#expense_user_ids").trigger("addItem", [<%= @users_expense %>]);  
      <% end %>
      
      <% if @users_expensegroup %>
      $("#expensegroup_user_ids").trigger("addItem", [<%= @users_expensegroup %>]);
      <% end %>
      
      <% if @expense_expensegroup %>
      $("#expense_expensegroup_ids").trigger("addItem", [<%= @expense_expensegroup %>]);    
      <% end %>
      
    }); 
    
  </script>
  
  <script type="text/javascript" charset="utf-8">
    $(document).ready(function(){
        $(".jquery-date-picker").each(function(){
            $(this).datepicker({ dateFormat: 'yy-mm-dd',constrainInput: false })
        });
        $(".skip-import-submit").click(function(){
            $(this).parent('form').remove();
            return false;
        });   
    })
  </script>
</head>
<body>
<div id="main-container">
    <div id="column-content" class="ui-corner-all">   
    <div id="application-content" class="clearfix">  
      <h1>Convivium</h1>         
      <% if current_user %>
      <script type="text/javascript" charset="utf-8">
        $(document).ready(function(){
          $("#column-right ul li a").button({ icons: {primary:'ui-icon-folder-collapsed'} });
          $("input:submit").button();
        });
      </script>

      <div id="column-right">
          <ul>
              <li><%= link_to t("Report"), {:controller => "expenses" , :action => "index"} %></li>
              <li><%= link_to t("Complete report"), {:controller => "report" , :action => "expense_report"} %></li>
              <li><%= link_to t("History"), {:controller => "report" , :action => "history"} %></li>
              <li><%= link_to t("Add expense"), { :controller => "expenses" , :action => "new"} %></li>
              <li><%= link_to t("Expense groups"), { :controller => "expensegroups" , :action => "index"} %></li>
              <li><%= link_to t("Categories"), { :controller => "categories" , :action => "index"} %></li>
          </ul>
      <% if current_user %>
      <div style="float:right;">
          <%= t 'Hi' %> <%= name_or_login current_user %>
          <%= link_to t('Logout'), { :controller => "sessions" , :action => "destroy"} %>
      </div>
      <% end %>
      </div>
      <% end %>
    
    <% if current_user %>
    <script type="text/javascript" charset="utf-8">
      $(document).ready(function(){
        $("#column-right ul li a").button({ icons: {primary:'ui-icon-folder-collapsed'} });
        $("input[type=submit]").button({ icons: {primary:'ui-icon-folder-collapsed'} });
      });
    </script>
    
      <% if flash[:notice] %>
        <div class="flash notice" id='notice'> <%= flash[:notice] %></div>
      <% end %>


      <% if flash[:error] %>    
        <div class="flash error" id='error'><%= flash[:error] %></div>
      <% end %> 
      
   <div style="margin-top:20px;width:214px;float:left;padding: 0px 4px 4px;" class="clearfix">
      <div id="portlets-container">
          <%= yield :portlets %>
      </div>
   </div>
   
   <div style="float:right;padding:15px;width:680px;" class="clearfix">      
      <%= yield %>     
      <br class="clear"/>    
   </div> 
   </div>
   </div>
</div>

</body>
</html>
